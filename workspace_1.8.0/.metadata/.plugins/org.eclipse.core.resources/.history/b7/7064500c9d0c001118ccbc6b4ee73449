/**
 ******************************************************************************
 * @file           : main.c
 * @author         : Auto-generated by STM32CubeIDE
 * @brief          : Main program body
 ******************************************************************************
 * @attention
 *
 * Copyright (c) 2026 STMicroelectronics.
 * All rights reserved.
 *
 * This software is licensed under terms that can be found in the LICENSE file
 * in the root directory of this software component.
 * If no LICENSE file comes with this software, it is provided AS-IS.
 *
 ******************************************************************************
 */
// JoyStick Program
#include <stdint.h>

#if !defined(__SOFT_FP__) && defined(__ARM_FP)
  #warning "FPU is not initialized, but the project is compiling for an FPU. Please initialize the FPU before use."
#endif

#include <stdint.h>

#define BIT(n)	(1U << (n))

//	Clock Register Mapping
#define RCC_APB2ENR (*((volatile uint32_t *)0x40023844))
#define RCC_AHB1ENR (*((volatile uint32_t *)0x40023830))
//	GPIO Register Mapping
#define GPIOA_MODER (*((volatile uint32_t *)0x40020000))
#define GPIOA_PUPDR	(*((volatile uint32_t *)0x4002000C))
#define GPIOA_IDR	(*((volatile uint32_t *)0x40020010))

//	ADC module 1 Register Mapping
#define ADC1_SR 	(*((volatile uint32_t *)0x40012000))
#define ADC1_CR1 	(*((volatile uint32_t *)0x40012004))
#define ADC1_CR2 	(*((volatile uint32_t *)0x40012008))
#define ADC1_SMPR2 	(*((volatile uint32_t *)0x40012010))
#define ADC1_SQR1 	(*((volatile uint32_t *)0x4001202C))
#define ADC1_SQR3 	(*((volatile uint32_t *)0x40012034))
#define ADC1_DR 	(*((volatile uint32_t *)0x4001204C))

volatile uint16_t result_x_axis = 0,result_y_axis = 0;
volatile uint8_t result_switch = 0;

int main(void)
{
	//	Clock Configuration
	RCC_AHB1ENR |= BIT(0);				//	Enable Clock to port A
	RCC_APB2ENR |= BIT(8);				//	Enable Clock to ADC module 1

	//	GPIO Configuration
	GPIOA_MODER |= (BIT(2) | BIT(3));	//	Analog mode for PA1	JoyStick x-axis
	GPIOA_MODER |= (BIT(5) | BIT(4));	//	Analog mode for PA2 JoyStick y-axis
	// Configure JoyStick Switch (PA3)
	GPIOA_MODER &= ~(BIT(7) | BIT(6));	//	Input mode for PA3 JoyStick switch
	GPIOA_PUPDR &= ~(BIT(7) | BIT(6));
	GPIOA_PUPDR |=  (BIT(6));			//	Set PA3 as PullUp

	//	Configuring ADC module 1
	ADC1_CR2 &= ~BIT(0);   				// Disable ADC first
	ADC1_CR1 |= BIT(8);					//	Scan mode enabled
	ADC1_CR2 |= BIT(1);					//	Continuous conversion mode
	ADC1_CR2 |= BIT(10);				//	The EOC bit is set at the end of each regular conversion.
	ADC1_SMPR2 |= ((7 << 3)|(7 << 6)); 	//	Max sampling time for channel 1(PA1) and channel 2(PA2)

	ADC1_SQR1 &= ~(0xF << 20);
	ADC1_SQR1 |= BIT(20);				//	Set sequence length to 2 conversion

	ADC1_SQR3 &= ~(0x3FF);
	ADC1_SQR3 |= (BIT(0)|BIT(6));		//	Set the channel sequence order

	ADC1_CR2 |= BIT(0);					//	Enable ADC
	ADC1_CR2 |= BIT(30);				//	Starts conversion of regular channels

	while(1)
	{
		while (!(ADC1_SR & BIT(1)));  // Wait for EOC
		result_x_axis = ADC1_DR;

		while (!(ADC1_SR & BIT(1)));  // Wait for EOC
		result_y_axis = ADC1_DR;

		if(!(GPIOA_IDR & BIT(3)))
		{
			result_switch = 1;
		}
		else
		{
			result_switch = 0;
		}
	}

	return 0;
}
